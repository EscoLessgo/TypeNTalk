// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Host {
  id          String   @id @default(uuid())
  uid         String   @unique // Lovense User ID
  username    String
  email       String?  @unique
  googleId    String?  @unique
  avatar      String?
  vanitySlug  String?  @unique
  settings    String?  @default("{}") // JSON for intensityCeiling, syncMode, etc.
  toys        String?  // Store current toy info (JSON string)
  connections Connection[]
  blacklist   Blacklist[]
  createdAt   DateTime @default(now())
}

model Blacklist {
  id        String   @id @default(uuid())
  hostId    String
  host      Host     @relation(fields: [hostId], references: [id])
  ip        String
  reason    String?
  createdAt DateTime @default(now())
}

model Connection {
  id        String   @id @default(uuid())
  slug      String   @unique // The random URL slug for the typist
  hostId    String
  host      Host     @relation(fields: [hostId], references: [id])
  approved  Boolean  @default(false)
  history   ResponseHistory[]
  visitorLogs VisitorLog[]
  createdAt DateTime @default(now())
}

model ResponseHistory {
  id           String     @id @default(uuid())
  connectionId String
  connection   Connection @relation(fields: [connectionId], references: [id])
  text         String
  pulses       String?    // JSON string array of {time, intensity, duration}
  isFavorite   Boolean    @default(false)
  createdAt    DateTime   @default(now())
}

model VisitorLog {
  id           String     @id @default(uuid())
  connectionId String?    // Optional because we might log general visits too
  connection   Connection? @relation(fields: [connectionId], references: [id])
  ip           String?
  path         String?    // e.g. /admin, /6c3249df
  userAgent    String?
  browser      String?
  os           String?
  device       String?
  city         String?
  region       String?
  regionName   String?
  country      String?
  countryCode  String?
  isp          String?
  org          String?
  as           String?
  zip          String?
  lat          Float?
  lon          Float?
  timezone     String?
  createdAt    DateTime   @default(now())
}
